[{"content":"üß™ Pi-hole DNS Migration to Production VLAN üß≠ Overview This phase of the HomeLab project documents the successful migration of the internal Pi-hole DNS server from the flat LAN network to a newly created and isolated Production VLAN. This change enhances security, improves segmentation, and prepares the environment for scalable DNS resolution across all other VLANs.\nüéØ Objectives Create and configure a dedicated Production VLAN on pfSense Migrate the Pi-hole LXC container to the new VLAN Ensure inter-VLAN DNS resolution using Pi-hole Apply proper firewall rules to restrict unnecessary access Update DHCP DNS settings across all VLANs üìä Network Summary Component Before Migration After Migration Pi-hole Location LAN network (untagged) Production VLAN (tagged) VLAN ID - Production VLAN ID Subnet LAN Subnet Production Subnet Pi-hole IP LAN Assigned IP VLAN-assigned static IP Access Open to LAN Inter-VLAN DNS only (port 53) üõ†Ô∏è Steps Performed 1. Created Production VLAN in pfSense Navigated to Interfaces \u0026gt; Assignments \u0026gt; VLANs Assigned a unique VLAN tag and set the parent interface (LAN) Created new interface, enabled it, and assigned a static IPv4 gateway 2. Updated Pi-hole LXC Container Configuration Edited the container via Proxmox: pct set \u0026lt;CTID\u0026gt; -net0 name=eth0,bridge=vmbr0,tag=\u0026lt;VLAN_ID\u0026gt;,ip=\u0026lt;Pi-hole_IP\u0026gt;/24,gw=\u0026lt;VLAN_Gateway\u0026gt; ","permalink":"https://blog.tillynet.com/my-home-lab-journey/pi-hole-dns-migration-to-production-vlan/","summary":"\u003ch1 id=\"-pi-hole-dns-migration-to-production-vlan\"\u003eüß™ Pi-hole DNS Migration to Production VLAN\u003c/h1\u003e\n\u003ch2 id=\"-overview\"\u003eüß≠ Overview\u003c/h2\u003e\n\u003cp\u003eThis phase of the HomeLab project documents the successful migration of the internal Pi-hole DNS server from the flat LAN network to a newly created and isolated \u003cstrong\u003eProduction VLAN\u003c/strong\u003e. This change enhances security, improves segmentation, and prepares the environment for scalable DNS resolution across all other VLANs.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"-objectives\"\u003eüéØ Objectives\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eCreate and configure a dedicated Production VLAN on pfSense\u003c/li\u003e\n\u003cli\u003eMigrate the Pi-hole LXC container to the new VLAN\u003c/li\u003e\n\u003cli\u003eEnsure inter-VLAN DNS resolution using Pi-hole\u003c/li\u003e\n\u003cli\u003eApply proper firewall rules to restrict unnecessary access\u003c/li\u003e\n\u003cli\u003eUpdate DHCP DNS settings across all VLANs\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"-network-summary\"\u003eüìä Network Summary\u003c/h2\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eComponent\u003c/th\u003e\n          \u003cth\u003eBefore Migration\u003c/th\u003e\n          \u003cth\u003eAfter Migration\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003ePi-hole Location\u003c/td\u003e\n          \u003ctd\u003eLAN network (untagged)\u003c/td\u003e\n          \u003ctd\u003eProduction VLAN (tagged)\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eVLAN ID\u003c/td\u003e\n          \u003ctd\u003e-\u003c/td\u003e\n          \u003ctd\u003eProduction VLAN ID\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eSubnet\u003c/td\u003e\n          \u003ctd\u003eLAN Subnet\u003c/td\u003e\n          \u003ctd\u003eProduction Subnet\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003ePi-hole IP\u003c/td\u003e\n          \u003ctd\u003eLAN Assigned IP\u003c/td\u003e\n          \u003ctd\u003eVLAN-assigned static IP\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAccess\u003c/td\u003e\n          \u003ctd\u003eOpen to LAN\u003c/td\u003e\n          \u003ctd\u003eInter-VLAN DNS only (port 53)\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003chr\u003e\n\u003ch2 id=\"-steps-performed\"\u003eüõ†Ô∏è Steps Performed\u003c/h2\u003e\n\u003ch3 id=\"1-created-production-vlan-in-pfsense\"\u003e1. Created Production VLAN in pfSense\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eNavigated to \u003cstrong\u003eInterfaces \u0026gt; Assignments \u0026gt; VLANs\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eAssigned a unique VLAN tag and set the parent interface (LAN)\u003c/li\u003e\n\u003cli\u003eCreated new interface, enabled it, and assigned a static IPv4 gateway\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"2-updated-pi-hole-lxc-container-configuration\"\u003e2. Updated Pi-hole LXC Container Configuration\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eEdited the container via Proxmox:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epct \u003cspan class=\"nb\"\u003eset\u003c/span\u003e \u0026lt;CTID\u0026gt; -net0 \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eeth0,bridge\u003cspan class=\"o\"\u003e=\u003c/span\u003evmbr0,tag\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;VLAN_ID\u0026gt;,ip\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;Pi-hole_IP\u0026gt;/24,gw\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;VLAN_Gateway\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Pi-hole DNS Migration to Production VLAN"},{"content":"üõ†Ô∏è Remote VLAN Recovery \u0026amp; Proxmox Network Repair over VPN üì° Project Title: Remote SDN Recovery \u0026amp; VLAN Isolation via VPN \u0026amp; Shell Access Overview In this project, I successfully re-established full access to my network management stack (Omada Controller, Proxmox GUI, and LXC containers) after losing access due to misconfigured VLAN trunking. The recovery was performed entirely off-site, using only a mobile device connected via an OpenVPN tunnel.\nüîç Background I transitioned my home lab management network to VLAN 99 to achieve full traffic isolation. In the process of re-tagging Proxmox and LXC container traffic and reconfiguring Cisco switch trunk ports, I lost access to the Omada Controller and Proxmox GUI. With no local access to the console, I needed a remote solution.\nüéØ Objective Regain access to VLAN 99 (management) Restore Omada Controller GUI and Proxmox Web GUI Ensure all traffic on management interfaces is VLAN 99 tagged üß∞ Tools Used Proxmox VE 8.3 pfSense (OpenVPN Server \u0026amp; Firewall) TP-Link Omada Controller (LXC) SSH (mobile terminal access) OpenVPN (Client-to-Site) VLAN-aware Linux bridges (vmbr1) Cisco Catalyst switch (trunk config) üîß Steps Performed Connected to VPN Tunnel 1 (LAN access)\nUsed an existing OpenVPN client-to-site tunnel connected to the LAN network Leveraged this connection as a starting point Established VPN Tunnel 2 (MGMT access)\nConfigured a new OpenVPN tunnel to reach VLAN 99 Verified routing and DNS from VPN client to MGMT subnet Accessed Proxmox Shell Remotely\nUsed SSH to access the Proxmox server shell Reviewed \u0026amp; Edited /etc/network/interfaces\nCreated a Linux Bridge vmbr1 on enp1s0 Configured vmbr1 as VLAN-aware with a VLAN 99 subinterface Reconfigured Omada Controller LXC\nSet static IP from VLAN 99 Edited /etc/pve/lxc/\u0026lt;vmid\u0026gt;.conf to tag interface correctly Updated pfSense Firewall Rules\nAllowed VPN access to Proxmox, Omada Controller, and LXCs Verified GUI access over VPN Safely Restarted Proxmox Networking Stack\nReloaded network stack without reboot to preserve SSH session Verified LXC \u0026amp; Controller Connectivity\nConfirmed restored access to Omada Controller \u0026amp; Proxmox GUI Checked VLAN 99 trunking on Cisco switch Secured VLAN 99\nBlocked all external access to VLAN 99 Allowed only OpenVPN tunnel access Tested Full Remote Management Over VPN\n‚úÖ Outcome Full recovery of Proxmox and Omada Controller Management services isolated to VLAN 99 VLAN trunking corrected on switch Secure remote access via OpenVPN tunnel All executed off-site using a mobile SSH client üì∏ Screenshots \u0026amp; CLI Snippets (To be added) Network configuration diagrams VLAN trunking layout ip a, bridge vlan, openvpn status üß† Lessons Learned Always test VLAN changes with fallback access Proxmox shell is essential for remote recovery OpenVPN enables secure remote SDN administration Avoid dual gateway configurations on bridges üîÆ Future Improvements Add fallback management IP on separate VLAN Setup out-of-band access (serial/IPMI) Automate Proxmox network config backups üßæ Resume Bullet Performed live remote SDN infrastructure recovery using OpenVPN and SSH from a mobile device; reconfigured VLAN-tagged Proxmox bridges, updated pfSense firewall rules, and restored access to critical network services including Omada Controller and LXC containers on an isolated management VLAN. ","permalink":"https://blog.tillynet.com/my-home-lab-journey/remote-vlan-recovery-proxmox-network-repair-over-vpn/","summary":"\u003ch1 id=\"-remote-vlan-recovery--proxmox-network-repair-over-vpn\"\u003eüõ†Ô∏è Remote VLAN Recovery \u0026amp; Proxmox Network Repair over VPN\u003c/h1\u003e\n\u003ch2 id=\"-project-title-remote-sdn-recovery--vlan-isolation-via-vpn--shell-access\"\u003eüì° Project Title: Remote SDN Recovery \u0026amp; VLAN Isolation via VPN \u0026amp; Shell Access\u003c/h2\u003e\n\u003ch3 id=\"overview\"\u003eOverview\u003c/h3\u003e\n\u003cp\u003eIn this project, I successfully re-established full access to my network management stack (Omada Controller, Proxmox GUI, and LXC containers) after losing access due to misconfigured VLAN trunking. The recovery was performed entirely \u003cstrong\u003eoff-site\u003c/strong\u003e, using only a mobile device connected via an \u003cstrong\u003eOpenVPN tunnel\u003c/strong\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"-background\"\u003eüîç Background\u003c/h3\u003e\n\u003cp\u003eI transitioned my home lab management network to VLAN 99 to achieve full traffic isolation. In the process of re-tagging Proxmox and LXC container traffic and reconfiguring Cisco switch trunk ports, I lost access to the Omada Controller and Proxmox GUI. With no local access to the console, I needed a remote solution.\u003c/p\u003e","title":"Remote VLAN Recovery \u0026 Proxmox Network Repair over VPN"},{"content":"üß† 02 - Migrating to a Dedicated Management VLAN (VLAN 99) This phase documents the migration of all core management infrastructure to an isolated VLAN (VLAN 99) for improved security, network segmentation, and long-term scalability. This included Proxmox GUI access, Omada Controller LXC, and strict firewall rules enforced via pfSense.\nüéØ Goals Remove critical services from default/native VLAN Assign a dedicated, isolated VLAN (VLAN 99) for: Proxmox management GUI Omada Controller (LXC) Trunk management VLAN through switch to Proxmox Implement firewall rules to allow remote admin access only Preserve service availability during transition üß± Pre-Migration Topology Component Network VLAN Interface Description Proxmox Host LAN VLAN 1 vmbr0 Static IP via native VLAN Omada Controller LAN VLAN 1 vmbr0 LXC container, web GUI on port 8043 Pi-hole LAN VLAN 1 vmbr0 DNS LXC VPN Tunnel LAN VLAN 1 pfSense Remote client-to-site access üß† Post-Migration Topology Component Network VLAN Interface Description Proxmox Host Management VLAN 99 vmbr1.99 Tagged IP for GUI access via vmbr1 Omada Controller Management VLAN 99 vmbr1 (tagged) LXC container with VLAN tag 99 Pi-hole LAN VLAN 1 vmbr0 LXC container Trunk Port (Switch) Trunked Port 1,99,14 enp1s0 Connected to VLAN-aware bridge vmbr1 VPN Tunnel Routed to MGMT VLAN 99 pfSense Allows external admin access to VLAN 99 üõ†Ô∏è Migration Steps 1. Create VLAN 99 in pfSense Interfaces \u0026gt; Assignments \u0026gt; VLANs Created VLAN 99 on the LAN parent interface Assigned it as a new interface and renamed it to MGMT Enabled the interface and set a static IP (management subnet) 2. Configure Proxmox Bridge for VLAN Tagging Created a new VLAN-aware bridge and subinterface in /etc/network/interfaces:\nauto vmbr1 iface vmbr1 inet manual bridge-ports enp1s0 bridge-stp off bridge-fd 0 bridge-vlan-aware yes bridge-vids 2-4094 auto vmbr1.99 iface vmbr1.99 inet static address \u0026lt;management_ip\u0026gt;/24 gateway \u0026lt;management_gateway\u0026gt; ","permalink":"https://blog.tillynet.com/my-home-lab-journey/creating-network-management-isolation/","summary":"\u003ch1 id=\"-02---migrating-to-a-dedicated-management-vlan-vlan-99\"\u003eüß† 02 - Migrating to a Dedicated Management VLAN (VLAN 99)\u003c/h1\u003e\n\u003cp\u003eThis phase documents the migration of all core management infrastructure to an isolated VLAN (VLAN 99) for improved security, network segmentation, and long-term scalability. This included Proxmox GUI access, Omada Controller LXC, and strict firewall rules enforced via pfSense.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"-goals\"\u003eüéØ Goals\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eRemove critical services from default/native VLAN\u003c/li\u003e\n\u003cli\u003eAssign a dedicated, isolated VLAN (VLAN 99) for:\n\u003cul\u003e\n\u003cli\u003eProxmox management GUI\u003c/li\u003e\n\u003cli\u003eOmada Controller (LXC)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eTrunk management VLAN through switch to Proxmox\u003c/li\u003e\n\u003cli\u003eImplement firewall rules to allow remote admin access only\u003c/li\u003e\n\u003cli\u003ePreserve service availability during transition\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"-pre-migration-topology\"\u003eüß± Pre-Migration Topology\u003c/h2\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eComponent\u003c/th\u003e\n          \u003cth\u003eNetwork\u003c/th\u003e\n          \u003cth\u003eVLAN\u003c/th\u003e\n          \u003cth\u003eInterface\u003c/th\u003e\n          \u003cth\u003eDescription\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eProxmox Host\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eLAN\u003c/td\u003e\n          \u003ctd\u003eVLAN 1\u003c/td\u003e\n          \u003ctd\u003evmbr0\u003c/td\u003e\n          \u003ctd\u003eStatic IP via native VLAN\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eOmada Controller\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eLAN\u003c/td\u003e\n          \u003ctd\u003eVLAN 1\u003c/td\u003e\n          \u003ctd\u003evmbr0\u003c/td\u003e\n          \u003ctd\u003eLXC container, web GUI on port 8043\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003ePi-hole\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eLAN\u003c/td\u003e\n          \u003ctd\u003eVLAN 1\u003c/td\u003e\n          \u003ctd\u003evmbr0\u003c/td\u003e\n          \u003ctd\u003eDNS LXC\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eVPN Tunnel\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eLAN\u003c/td\u003e\n          \u003ctd\u003eVLAN 1\u003c/td\u003e\n          \u003ctd\u003epfSense\u003c/td\u003e\n          \u003ctd\u003eRemote client-to-site access\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003chr\u003e\n\u003ch2 id=\"-post-migration-topology\"\u003eüß† Post-Migration Topology\u003c/h2\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eComponent\u003c/th\u003e\n          \u003cth\u003eNetwork\u003c/th\u003e\n          \u003cth\u003eVLAN\u003c/th\u003e\n          \u003cth\u003eInterface\u003c/th\u003e\n          \u003cth\u003eDescription\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eProxmox Host\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eManagement\u003c/td\u003e\n          \u003ctd\u003eVLAN 99\u003c/td\u003e\n          \u003ctd\u003evmbr1.99\u003c/td\u003e\n          \u003ctd\u003eTagged IP for GUI access via \u003ccode\u003evmbr1\u003c/code\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eOmada Controller\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eManagement\u003c/td\u003e\n          \u003ctd\u003eVLAN 99\u003c/td\u003e\n          \u003ctd\u003evmbr1 (tagged)\u003c/td\u003e\n          \u003ctd\u003eLXC container with VLAN tag 99\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003ePi-hole\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eLAN\u003c/td\u003e\n          \u003ctd\u003eVLAN 1\u003c/td\u003e\n          \u003ctd\u003evmbr0\u003c/td\u003e\n          \u003ctd\u003eLXC container\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eTrunk Port (Switch)\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eTrunked Port\u003c/td\u003e\n          \u003ctd\u003e1,99,14\u003c/td\u003e\n          \u003ctd\u003eenp1s0\u003c/td\u003e\n          \u003ctd\u003eConnected to VLAN-aware bridge \u003ccode\u003evmbr1\u003c/code\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eVPN Tunnel\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eRouted to MGMT\u003c/td\u003e\n          \u003ctd\u003eVLAN 99\u003c/td\u003e\n          \u003ctd\u003epfSense\u003c/td\u003e\n          \u003ctd\u003eAllows external admin access to VLAN 99\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003chr\u003e\n\u003ch2 id=\"-migration-steps\"\u003eüõ†Ô∏è Migration Steps\u003c/h2\u003e\n\u003ch3 id=\"1-create-vlan-99-in-pfsense\"\u003e1. Create VLAN 99 in pfSense\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eInterfaces \u0026gt; Assignments \u0026gt; VLANs\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eCreated VLAN 99 on the LAN parent interface\u003c/li\u003e\n\u003cli\u003eAssigned it as a new interface and renamed it to \u003ccode\u003eMGMT\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eEnabled the interface and set a static IP (management subnet)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"2-configure-proxmox-bridge-for-vlan-tagging\"\u003e2. Configure Proxmox Bridge for VLAN Tagging\u003c/h3\u003e\n\u003cp\u003eCreated a new VLAN-aware bridge and subinterface in \u003ccode\u003e/etc/network/interfaces\u003c/code\u003e:\u003c/p\u003e","title":"Creating Network Management Isolation"},{"content":"üè° HomeLab: Initial Network Setup This project documents the first working phase of my home network infrastructure built on top of Proxmox, using pfSense as a virtual firewall/router and LXC containers to host internal services. The design lays the foundation for a scalable, secure, and isolated home lab environment.\nüåê Overview Hypervisor: Proxmox VE running on Protectli Vault (Intel J6412, 4 NICs) Router/Firewall: pfSense VM Internal Services: Pi-hole (LXC) ‚Äì local DNS + ad-blocking Omada Controller (LXC) ‚Äì TP-Link AP management LAN Devices: Proxmox host, personal workstation, AP, switch Guest Devices: IoT \u0026amp; roommate devices on isolated VLAN 14 üèóÔ∏è Infrastructure at a Glance Component Description pfSense VM with two PCI-passthrough NICs (WAN + LAN) vmbr0 Bridge for LAN (Proxmox + LXCs) vmbr1 Reserved for future VLAN tagging (e.g., mgmt) Pi-hole LXC container for DNS (on LAN) Omada Ctrl LXC container managing TP-Link EAP670 AP Cisco Switch Access switch trunking VLANs to Proxmox/AP Guest VLAN 14 WiFi-only VLAN for roommate \u0026amp; IoT devices üöÄ Setup Timeline ‚úÖ Phase 1 ‚Äì Core Infrastructure Flashed Proxmox onto Protectli Vault Created pfSense VM with 2 passthrough NICs: WAN: connected to ISP modem LAN: connected to Cisco switch (trunk-ready) Configured vmbr0 as LAN bridge in Proxmox Gave Proxmox host static IP on the LAN network ‚úÖ Phase 2 ‚Äì Internal Services Provisioned LXC container for Pi-hole Static IP assigned Configured upstream DNS servers (e.g., Cloudflare) Provisioned LXC container for Omada Controller Used to manage TP-Link EAP670 AP Served on LAN via Omada web GUI (port 8043) ‚úÖ Phase 3 ‚Äì Wireless \u0026amp; Guest VLAN Set up VLAN 14 in pfSense (Guest Network) Trunked VLANs through switch port to Omada AP Created isolated wireless SSID mapped to VLAN 14 Configured firewall rules in pfSense: Guests can access WAN only Blocked access to LAN and Pi-hole Verified DHCP lease and internet access for guests Observed isolated traffic from personal network üîê Security Practices Created distinct VLANs for guest vs personal network Isolated Pi-hole to LAN access only Disabled inter-VLAN routing from Guest ‚Üí LAN Assigned firewall rules by interface in pfSense Reserved management services for trusted VLAN only üîç To-Do / Next Steps Create VLAN 99 for network management Move Proxmox GUI and Omada Controller to VLAN 99 Add remote access via OpenVPN (completed later) Diagram full topology and backup strategy üì∏ Network Diagram Will include:\nProxmox bridges ‚Üí pfSense VM ‚Üí Switch trunk ‚Üí AP ‚Üí VLAN segmentation\nüß† Lessons Learned Always reserve a static fallback IP for management pfSense is extremely powerful when paired with LXC containers VLANs and firewall rules are critical to proper isolation Omada Controller offers enterprise-like wireless management üìå Repo Series 01_initial-setup.md ‚Üí This doc 02_management-vlan.md ‚Üí VLAN 99 migration 03_remote-recovery.md ‚Üí Recovery via OpenVPN (see separate log) 04_automation.md ‚Üí Cron/Ansible update automation 05_certificates.md ‚Üí Internal SSL management (Pi-hole, Omada, pfSense) üßæ Resume Bullet (from this phase) Deployed full virtual home network lab with pfSense firewall, VLAN isolation, and internal services (DNS, WiFi controller) using Proxmox and LXC containers; implemented guest network segregation and trunked VLANs across Cisco infrastructure. ","permalink":"https://blog.tillynet.com/my-home-lab-journey/the-big-bang-how-it-all-began/","summary":"\u003ch1 id=\"-homelab-initial-network-setup\"\u003eüè° HomeLab: Initial Network Setup\u003c/h1\u003e\n\u003cp\u003eThis project documents the first working phase of my home network infrastructure built on top of Proxmox, using pfSense as a virtual firewall/router and LXC containers to host internal services. The design lays the foundation for a scalable, secure, and isolated home lab environment.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"-overview\"\u003eüåê Overview\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eHypervisor:\u003c/strong\u003e Proxmox VE running on Protectli Vault (Intel J6412, 4 NICs)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eRouter/Firewall:\u003c/strong\u003e pfSense VM\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eInternal Services:\u003c/strong\u003e\n\u003cul\u003e\n\u003cli\u003ePi-hole (LXC) ‚Äì local DNS + ad-blocking\u003c/li\u003e\n\u003cli\u003eOmada Controller (LXC) ‚Äì TP-Link AP management\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eLAN Devices:\u003c/strong\u003e Proxmox host, personal workstation, AP, switch\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGuest Devices:\u003c/strong\u003e IoT \u0026amp; roommate devices on isolated VLAN 14\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"-infrastructure-at-a-glance\"\u003eüèóÔ∏è Infrastructure at a Glance\u003c/h2\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eComponent\u003c/th\u003e\n          \u003cth\u003eDescription\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003epfSense\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eVM with two PCI-passthrough NICs (WAN + LAN)\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003evmbr0\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eBridge for LAN (Proxmox + LXCs)\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003evmbr1\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eReserved for future VLAN tagging (e.g., mgmt)\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003ePi-hole\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eLXC container for DNS (on LAN)\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eOmada Ctrl\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eLXC container managing TP-Link EAP670 AP\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eCisco Switch\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eAccess switch trunking VLANs to Proxmox/AP\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eGuest VLAN 14\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eWiFi-only VLAN for roommate \u0026amp; IoT devices\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003chr\u003e\n\u003ch2 id=\"-setup-timeline\"\u003eüöÄ Setup Timeline\u003c/h2\u003e\n\u003ch3 id=\"-phase-1--core-infrastructure\"\u003e‚úÖ Phase 1 ‚Äì Core Infrastructure\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eFlashed Proxmox onto Protectli Vault\u003c/li\u003e\n\u003cli\u003eCreated pfSense VM with 2 passthrough NICs:\n\u003cul\u003e\n\u003cli\u003eWAN: connected to ISP modem\u003c/li\u003e\n\u003cli\u003eLAN: connected to Cisco switch (trunk-ready)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eConfigured \u003ccode\u003evmbr0\u003c/code\u003e as LAN bridge in Proxmox\u003c/li\u003e\n\u003cli\u003eGave Proxmox host static IP on the LAN network\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"-phase-2--internal-services\"\u003e‚úÖ Phase 2 ‚Äì Internal Services\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eProvisioned LXC container for Pi-hole\n\u003cul\u003e\n\u003cli\u003eStatic IP assigned\u003c/li\u003e\n\u003cli\u003eConfigured upstream DNS servers (e.g., Cloudflare)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eProvisioned LXC container for Omada Controller\n\u003cul\u003e\n\u003cli\u003eUsed to manage TP-Link EAP670 AP\u003c/li\u003e\n\u003cli\u003eServed on LAN via Omada web GUI (port 8043)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"-phase-3--wireless--guest-vlan\"\u003e‚úÖ Phase 3 ‚Äì Wireless \u0026amp; Guest VLAN\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eSet up VLAN 14 in pfSense (Guest Network)\u003c/li\u003e\n\u003cli\u003eTrunked VLANs through switch port to Omada AP\u003c/li\u003e\n\u003cli\u003eCreated isolated wireless SSID mapped to VLAN 14\u003c/li\u003e\n\u003cli\u003eConfigured firewall rules in pfSense:\n\u003cul\u003e\n\u003cli\u003eGuests can access WAN only\u003c/li\u003e\n\u003cli\u003eBlocked access to LAN and Pi-hole\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eVerified DHCP lease and internet access for guests\u003c/li\u003e\n\u003cli\u003eObserved isolated traffic from personal network\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"-security-practices\"\u003eüîê Security Practices\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eCreated distinct VLANs for guest vs personal network\u003c/li\u003e\n\u003cli\u003eIsolated Pi-hole to LAN access only\u003c/li\u003e\n\u003cli\u003eDisabled inter-VLAN routing from Guest ‚Üí LAN\u003c/li\u003e\n\u003cli\u003eAssigned firewall rules by interface in pfSense\u003c/li\u003e\n\u003cli\u003eReserved management services for trusted VLAN only\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"-to-do--next-steps\"\u003eüîç To-Do / Next Steps\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eCreate VLAN 99 for network management\u003c/li\u003e\n\u003cli\u003eMove Proxmox GUI and Omada Controller to VLAN 99\u003c/li\u003e\n\u003cli\u003eAdd remote access via OpenVPN (completed later)\u003c/li\u003e\n\u003cli\u003eDiagram full topology and backup strategy\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"-network-diagram\"\u003eüì∏ Network Diagram\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"Image\" loading=\"lazy\" src=\"/images/TillyNet_OG.drawio.png\"\u003e\u003c/p\u003e","title":"The Big Bang (How it All Began)"}]