<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Current Running Version of TillyNet | Tilly Net</title>
<meta name="keywords" content="homelab, proxmox, pfsense, lxc, vlan, firewall, pihole, omada, network-segmentation, self-hosted">
<meta name="description" content="Current Running Version of TillyNet
TillyNet is my custom-built home lab environment designed to practice enterprise-grade network segmentation, high availability, and security enforcement using open-source tools. This architecture simulates production-level infrastructure and showcases my capabilities in network engineering, virtualization, firewall administration, and Linux system management.

Network Topology


Network Design Objectives

Layer 2/3 segmentation using VLANs
Centralized routing and firewalling with pfSense
Hypervisor-based infrastructure using Proxmox VE
Containerized services for DNS and wireless controller management
Policy-based access control enforced through inter-VLAN firewall rules
Minimal trust zones with internal DNS filtering and strict pathing


VLAN Overview

  
      
          VLAN ID
          Purpose
          Subnet
      
  
  
      
          1
          Default/legacy
          172.16.7.0/24
      
      
          14
          Guest Wi-Fi
          172.16.14.0/24
      
      
          21
          Production DNS
          172.21.21.0/24
      
      
          99
          Management Access
          172.16.99.0/24
      
      
          666
          Native Trunk VLAN
          N/A
      
  

Each VLAN is routed via a pfSense firewall using a router-on-a-stick model over a single trunk interface connected to a managed Cisco Catalyst switch.">
<meta name="author" content="">
<link rel="canonical" href="https://blog.tillynet.com/my-home-lab-journey/current-running-version-of-tillynet/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://blog.tillynet.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.tillynet.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.tillynet.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.tillynet.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.tillynet.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://blog.tillynet.com/my-home-lab-journey/current-running-version-of-tillynet/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://blog.tillynet.com/my-home-lab-journey/current-running-version-of-tillynet/">
  <meta property="og:site_name" content="Tilly Net">
  <meta property="og:title" content="Current Running Version of TillyNet">
  <meta property="og:description" content="Current Running Version of TillyNet TillyNet is my custom-built home lab environment designed to practice enterprise-grade network segmentation, high availability, and security enforcement using open-source tools. This architecture simulates production-level infrastructure and showcases my capabilities in network engineering, virtualization, firewall administration, and Linux system management.
Network Topology Network Design Objectives Layer 2/3 segmentation using VLANs Centralized routing and firewalling with pfSense Hypervisor-based infrastructure using Proxmox VE Containerized services for DNS and wireless controller management Policy-based access control enforced through inter-VLAN firewall rules Minimal trust zones with internal DNS filtering and strict pathing VLAN Overview VLAN ID Purpose Subnet 1 Default/legacy 172.16.7.0/24 14 Guest Wi-Fi 172.16.14.0/24 21 Production DNS 172.21.21.0/24 99 Management Access 172.16.99.0/24 666 Native Trunk VLAN N/A Each VLAN is routed via a pfSense firewall using a router-on-a-stick model over a single trunk interface connected to a managed Cisco Catalyst switch.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="my-home-lab-journey">
    <meta property="article:published_time" content="2025-04-22T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-04-22T00:00:00+00:00">
    <meta property="article:tag" content="Homelab">
    <meta property="article:tag" content="Proxmox">
    <meta property="article:tag" content="Pfsense">
    <meta property="article:tag" content="Lxc">
    <meta property="article:tag" content="Vlan">
    <meta property="article:tag" content="Firewall">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Current Running Version of TillyNet">
<meta name="twitter:description" content="Current Running Version of TillyNet
TillyNet is my custom-built home lab environment designed to practice enterprise-grade network segmentation, high availability, and security enforcement using open-source tools. This architecture simulates production-level infrastructure and showcases my capabilities in network engineering, virtualization, firewall administration, and Linux system management.

Network Topology


Network Design Objectives

Layer 2/3 segmentation using VLANs
Centralized routing and firewalling with pfSense
Hypervisor-based infrastructure using Proxmox VE
Containerized services for DNS and wireless controller management
Policy-based access control enforced through inter-VLAN firewall rules
Minimal trust zones with internal DNS filtering and strict pathing


VLAN Overview

  
      
          VLAN ID
          Purpose
          Subnet
      
  
  
      
          1
          Default/legacy
          172.16.7.0/24
      
      
          14
          Guest Wi-Fi
          172.16.14.0/24
      
      
          21
          Production DNS
          172.21.21.0/24
      
      
          99
          Management Access
          172.16.99.0/24
      
      
          666
          Native Trunk VLAN
          N/A
      
  

Each VLAN is routed via a pfSense firewall using a router-on-a-stick model over a single trunk interface connected to a managed Cisco Catalyst switch.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "My-Home-Lab-Journeys",
      "item": "https://blog.tillynet.com/my-home-lab-journey/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Current Running Version of TillyNet",
      "item": "https://blog.tillynet.com/my-home-lab-journey/current-running-version-of-tillynet/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Current Running Version of TillyNet",
  "name": "Current Running Version of TillyNet",
  "description": "Current Running Version of TillyNet TillyNet is my custom-built home lab environment designed to practice enterprise-grade network segmentation, high availability, and security enforcement using open-source tools. This architecture simulates production-level infrastructure and showcases my capabilities in network engineering, virtualization, firewall administration, and Linux system management.\nNetwork Topology Network Design Objectives Layer 2/3 segmentation using VLANs Centralized routing and firewalling with pfSense Hypervisor-based infrastructure using Proxmox VE Containerized services for DNS and wireless controller management Policy-based access control enforced through inter-VLAN firewall rules Minimal trust zones with internal DNS filtering and strict pathing VLAN Overview VLAN ID Purpose Subnet 1 Default/legacy 172.16.7.0/24 14 Guest Wi-Fi 172.16.14.0/24 21 Production DNS 172.21.21.0/24 99 Management Access 172.16.99.0/24 666 Native Trunk VLAN N/A Each VLAN is routed via a pfSense firewall using a router-on-a-stick model over a single trunk interface connected to a managed Cisco Catalyst switch.\n",
  "keywords": [
    "homelab", "proxmox", "pfsense", "lxc", "vlan", "firewall", "pihole", "omada", "network-segmentation", "self-hosted"
  ],
  "articleBody": "Current Running Version of TillyNet TillyNet is my custom-built home lab environment designed to practice enterprise-grade network segmentation, high availability, and security enforcement using open-source tools. This architecture simulates production-level infrastructure and showcases my capabilities in network engineering, virtualization, firewall administration, and Linux system management.\nNetwork Topology Network Design Objectives Layer 2/3 segmentation using VLANs Centralized routing and firewalling with pfSense Hypervisor-based infrastructure using Proxmox VE Containerized services for DNS and wireless controller management Policy-based access control enforced through inter-VLAN firewall rules Minimal trust zones with internal DNS filtering and strict pathing VLAN Overview VLAN ID Purpose Subnet 1 Default/legacy 172.16.7.0/24 14 Guest Wi-Fi 172.16.14.0/24 21 Production DNS 172.21.21.0/24 99 Management Access 172.16.99.0/24 666 Native Trunk VLAN N/A Each VLAN is routed via a pfSense firewall using a router-on-a-stick model over a single trunk interface connected to a managed Cisco Catalyst switch.\nCore Infrastructure Router/Firewall pfSense (virtualized) on a dedicated x86 appliance Handles inter-VLAN routing, DHCP, NAT, and firewall policy enforcement Configured with strict rules: Inter-VLAN traffic is blocked by default Each VLAN is only permitted DNS access to a local recursive DNS server Admin GUI access is restricted to the management VLAN Proxmox Virtualization Host: Protectli Vault (fanless x86 appliance)\nProxmox VE 8.3 running:\npfSense VM (firewall/gateway) LXC container: Pi-hole DNS (VLAN 21) LXC container: Omada Controller (VLAN 99) Network bridges:\nvmbr0: Management (backup) vmbr1: Trunked interface to switch (VLANs 14, 21, 99) vmbr1.99: Tagged VLAN interface for host-level MGMT access Linux Networking (Proxmox) The Proxmox host is configured using Linux network bridges with VLAN-aware capabilities to support secure, segmented networking for containers and virtual machines. All networking is statically defined in /etc/network/interfaces, offering full control and reproducibility of the setup.\nThis design ensures:\nVLAN tagging at the hypervisor level\nTrunk delivery of VLANs to LXCs and pfSense VM\nHost isolation through a dedicated VLAN interface (vmbr1.99)\nCompatibility with PCI passthrough NICs for physical routing\nNetwork Interface Layout Interface Role Type IP Address Notes enp2s0 pfSense LAN PCI passthru — Routed to switch for VLAN trunking enp3s0 pfSense WAN PCI passthru — Connected to ISP modem enp1s0 MGMT bridge uplink Physical — Tagged VLAN trunk to Catalyst enp4s0 Backup management Physical — Static untagged link vmbr0 Backup mgmt bridge Linux bridge 172.16.7.15/24 Management fallback IP vmbr1 VLAN trunk bridge Linux bridge — Tagged VLAN trunk to containers vmbr1.99 Host MGMT interface VLAN subif 172.16.99.15/24 Used for Proxmox admin access /etc/network/interfaces Configuration\nauto lo iface lo inet loopback # Backup Management Physical NIC iface enp4s0 inet manual # MGMT Trunk NIC iface enp1s0 inet manual # PCI Passthrough to pfSense iface enp2s0 inet manual iface enp3s0 inet manual # Backup Management Bridge (Plan to decommission) auto vmbr0 iface vmbr0 inet static address 172.16.7.15/24 bridge-ports enp4s0 bridge-stp off bridge-fd 0 bridge-vlan-aware yes bridge-vids 2-4094 dns-nameservers 1.1.1.1 8.8.8.8 # MGMT Trunk Bridge auto vmbr1 iface vmbr1 inet manual bridge-ports enp1s0 bridge-stp off bridge-fd 0 bridge-vlan-aware yes bridge-vids 2-4094 # VLAN 99 Subinterface for Proxmox Host auto vmbr1.99 iface vmbr1.99 inet static address 172.16.99.15/24 gateway 172.16.99.1 VLAN Usage by Containers Each LXC container is assigned to the appropriate VLAN through Proxmox’s vlan tag setting, while still connected to the same vmbr1 bridge. This enables seamless multi-VLAN networking without needing additional physical NICs.\nOmada Controller:\nBridge: vmbr1 VLAN Tag: 99 IP: 172.16.99.35/24 Pi-hole DNS:\nBridge: vmbr1 VLAN Tag: 21 IP: 172.21.21.21/24 With this configuration, containers receive only the VLAN traffic they are explicitly assigned, and host-level access is limited to a single tagged VLAN interface — a model that mirrors enterprise best practices in virtual networking.\nHost-Level VLAN Interface To maintain separation between the Proxmox host and the container traffic, a dedicated subinterface vmbr1.99 is configured for the management VLAN. This allows host-level SSH and web access only from the management network.\nauto vmbr1.99 iface vmbr1.99 inet static address 172.16.99.15/24 gateway 172.16.99.1 vlan-raw-device vmbr1 LXC Automation \u0026 Cron Jobs To maintain the health and performance of containerized services within TillyNet, I’ve implemented lightweight automation using cron inside each LXC. This approach keeps core services updated and resilient without the overhead of full-scale configuration management tools — while still remaining extensible.\nPi-hole (LXC 300) Automated via root cron job:\n# Run Pi-hole gravity update daily at 2:00 AM 0 2 * * * /usr/local/bin/pihole updateGravity \u003e /var/log/pihole_cron.log 2\u003e\u00261 This ensures the ad-blocking and threat feed lists are kept up-to-date without manual intervention.\nOmada Controller (LXC 200) Automated via cron for regular backups:\n# Backup Omada site config every day at 3:00 AM 0 3 * * * /opt/tplink/omada/data/autobackup.sh \u003e\u003e /var/log/omada_backup.log 2\u003e\u00261 The backup script syncs the controller config and wireless SSID/site layout to a local or external backup target.\nSystem-Wide (Both LXCs) General update routine:\n# Security updates every Sunday at 4:00 AM 0 4 * * 0 apt update \u0026\u0026 apt -y upgrade \u003e\u003e /var/log/apt_cron.log 2\u003e\u00261 This ensures both containers remain patched and secured, with logs rotated weekly via logrotate.\nServices \u0026 Roles Service Location IP (Subnet) VLAN Notes Firewall/Gateway pfSense VM Trunked interface All Routes all VLANs DNS Filtering Pi-hole LXC 172.21.21.21/24 21 Internal DNS for all VLANs WAP Control Omada Controller 172.16.99.35/24 99 Manages EAP access points Management GUI Proxmox Host 172.16.99.15/24 99 VLAN-tagged virtual interface Switching Layer Cisco Catalyst 2960-C switch Configured with trunk ports for uplinks and Proxmox host Native VLAN 666 used to isolate untagged traffic Access and trunk ports statically assigned to appropriate VLANs STP (PVST) with system-id extension enabled Wireless Infrastructure Access Point: TP-Link Omada EAP series Guest Wi-Fi SSID isolated via VLAN 14 WPA2/WPA3 mixed security VLAN tagging applied per SSID to ensure proper segmentation Security Posture DNS Centralization: All VLANs rely on a local Pi-hole for DNS queries Access Control: Only specific ports (e.g., DNS, admin access) allowed Microsegmentation: Each VLAN is isolated; no lateral movement allowed GUI Lockdown: Firewall admin access restricted to trusted VLAN Guest Isolation: Guest devices have zero access to internal infrastructure Learning Outcomes \u0026 Skills Demonstrated Advanced VLAN trunking and switch configuration Implementation of router-on-a-stick using pfSense Design of containerized services using LXC on Proxmox Mastery of firewall rule creation and policy-based routing Application of zero trust principles in a home network Real-world exposure to enterprise wireless configuration Linux and open-source toolchain integration Final Notes This deployment represents the current live version of TillyNet and serves both as a personal learning platform and a functional demonstration of scalable, secure network design. Each layer is intentionally crafted to mirror best practices seen in production environments across SMB and enterprise infrastructure.\nFuture plans include using Ansible for automated provisioning of LXC containers and firewall rule templating. This is version 2.0 of TillyNet. Future versions will expand automation, introduce container orchestration, and deploy a backup DNS service.\n",
  "wordCount" : "1114",
  "inLanguage": "en",
  "datePublished": "2025-04-22T00:00:00Z",
  "dateModified": "2025-04-22T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.tillynet.com/my-home-lab-journey/current-running-version-of-tillynet/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Tilly Net",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.tillynet.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.tillynet.com/" accesskey="h" title="Tilly Net (Alt + H)">Tilly Net</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://blog.tillynet.com/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://blog.tillynet.com/my-home-lab-journey/" title="My Home Lab Journey">
                    <span>My Home Lab Journey</span>
                </a>
            </li>
            <li>
                <a href="https://blog.tillynet.com/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://blog.tillynet.com/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Current Running Version of TillyNet
    </h1>
    <div class="post-meta"><span title='2025-04-22 00:00:00 +0000 UTC'>April 22, 2025</span>&nbsp;·&nbsp;6 min

</div>
  </header> 
  <div class="post-content"><h1 id="current-running-version-of-tillynet">Current Running Version of TillyNet<a hidden class="anchor" aria-hidden="true" href="#current-running-version-of-tillynet">#</a></h1>
<p>TillyNet is my custom-built home lab environment designed to practice enterprise-grade network segmentation, high availability, and security enforcement using open-source tools. This architecture simulates production-level infrastructure and showcases my capabilities in network engineering, virtualization, firewall administration, and Linux system management.</p>
<hr>
<h2 id="network-topology">Network Topology<a hidden class="anchor" aria-hidden="true" href="#network-topology">#</a></h2>
<p><img alt="Image" loading="lazy" src="/images/tillynet_mermaid.png"></p>
<hr>
<h2 id="network-design-objectives">Network Design Objectives<a hidden class="anchor" aria-hidden="true" href="#network-design-objectives">#</a></h2>
<ul>
<li><strong>Layer 2/3 segmentation</strong> using VLANs</li>
<li><strong>Centralized routing and firewalling</strong> with pfSense</li>
<li><strong>Hypervisor-based infrastructure</strong> using Proxmox VE</li>
<li><strong>Containerized services</strong> for DNS and wireless controller management</li>
<li><strong>Policy-based access control</strong> enforced through inter-VLAN firewall rules</li>
<li><strong>Minimal trust zones</strong> with internal DNS filtering and strict pathing</li>
</ul>
<hr>
<h2 id="vlan-overview">VLAN Overview<a hidden class="anchor" aria-hidden="true" href="#vlan-overview">#</a></h2>
<table>
  <thead>
      <tr>
          <th>VLAN ID</th>
          <th>Purpose</th>
          <th>Subnet</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Default/legacy</td>
          <td>172.16.7.0/24</td>
      </tr>
      <tr>
          <td>14</td>
          <td>Guest Wi-Fi</td>
          <td>172.16.14.0/24</td>
      </tr>
      <tr>
          <td>21</td>
          <td>Production DNS</td>
          <td>172.21.21.0/24</td>
      </tr>
      <tr>
          <td>99</td>
          <td>Management Access</td>
          <td>172.16.99.0/24</td>
      </tr>
      <tr>
          <td>666</td>
          <td>Native Trunk VLAN</td>
          <td>N/A</td>
      </tr>
  </tbody>
</table>
<p>Each VLAN is routed via a pfSense firewall using a router-on-a-stick model over a single trunk interface connected to a managed Cisco Catalyst switch.</p>
<hr>
<h2 id="core-infrastructure">Core Infrastructure<a hidden class="anchor" aria-hidden="true" href="#core-infrastructure">#</a></h2>
<h3 id="routerfirewall">Router/Firewall<a hidden class="anchor" aria-hidden="true" href="#routerfirewall">#</a></h3>
<ul>
<li><strong>pfSense (virtualized)</strong> on a dedicated x86 appliance</li>
<li>Handles inter-VLAN routing, DHCP, NAT, and firewall policy enforcement</li>
<li>Configured with strict rules:
<ul>
<li>Inter-VLAN traffic is blocked by default</li>
<li>Each VLAN is only permitted DNS access to a local recursive DNS server</li>
<li>Admin GUI access is restricted to the management VLAN</li>
</ul>
</li>
</ul>
<h3 id="proxmox-virtualization">Proxmox Virtualization<a hidden class="anchor" aria-hidden="true" href="#proxmox-virtualization">#</a></h3>
<ul>
<li>
<p><strong>Host</strong>: Protectli Vault (fanless x86 appliance)</p>
</li>
<li>
<p><strong>Proxmox VE 8.3</strong> running:</p>
<ul>
<li>pfSense VM (firewall/gateway)</li>
<li>LXC container: Pi-hole DNS (VLAN 21)</li>
<li>LXC container: Omada Controller (VLAN 99)</li>
</ul>
</li>
<li>
<p><strong>Network bridges</strong>:</p>
<ul>
<li><code>vmbr0</code>: Management (backup)</li>
<li><code>vmbr1</code>: Trunked interface to switch (VLANs 14, 21, 99)</li>
<li><code>vmbr1.99</code>: Tagged VLAN interface for host-level MGMT access</li>
</ul>
</li>
</ul>
<hr>
<h2 id="linux-networking-proxmox">Linux Networking (Proxmox)<a hidden class="anchor" aria-hidden="true" href="#linux-networking-proxmox">#</a></h2>
<p>The Proxmox host is configured using Linux network bridges with VLAN-aware capabilities to support secure, segmented networking for containers and virtual machines. All networking is statically defined in <code>/etc/network/interfaces</code>, offering full control and reproducibility of the setup.</p>
<p>This design ensures:</p>
<ul>
<li>
<p><strong>VLAN tagging at the hypervisor level</strong></p>
</li>
<li>
<p><strong>Trunk delivery</strong> of VLANs to LXCs and pfSense VM</p>
</li>
<li>
<p><strong>Host isolation</strong> through a dedicated VLAN interface (<code>vmbr1.99</code>)</p>
</li>
<li>
<p>Compatibility with <strong>PCI passthrough NICs</strong> for physical routing</p>
</li>
</ul>
<h4 id="network-interface-layout">Network Interface Layout<a hidden class="anchor" aria-hidden="true" href="#network-interface-layout">#</a></h4>
<table>
  <thead>
      <tr>
          <th>Interface</th>
          <th>Role</th>
          <th>Type</th>
          <th>IP Address</th>
          <th>Notes</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>enp2s0</code></td>
          <td>pfSense LAN</td>
          <td>PCI passthru</td>
          <td>—</td>
          <td>Routed to switch for VLAN trunking</td>
      </tr>
      <tr>
          <td><code>enp3s0</code></td>
          <td>pfSense WAN</td>
          <td>PCI passthru</td>
          <td>—</td>
          <td>Connected to ISP modem</td>
      </tr>
      <tr>
          <td><code>enp1s0</code></td>
          <td>MGMT bridge uplink</td>
          <td>Physical</td>
          <td>—</td>
          <td>Tagged VLAN trunk to Catalyst</td>
      </tr>
      <tr>
          <td><code>enp4s0</code></td>
          <td>Backup management</td>
          <td>Physical</td>
          <td>—</td>
          <td>Static untagged link</td>
      </tr>
      <tr>
          <td><code>vmbr0</code></td>
          <td>Backup mgmt bridge</td>
          <td>Linux bridge</td>
          <td>172.16.7.15/24</td>
          <td>Management fallback IP</td>
      </tr>
      <tr>
          <td><code>vmbr1</code></td>
          <td>VLAN trunk bridge</td>
          <td>Linux bridge</td>
          <td>—</td>
          <td>Tagged VLAN trunk to containers</td>
      </tr>
      <tr>
          <td><code>vmbr1.99</code></td>
          <td>Host MGMT interface</td>
          <td>VLAN subif</td>
          <td>172.16.99.15/24</td>
          <td>Used for Proxmox admin access</td>
      </tr>
  </tbody>
</table>
<p><code>/etc/network/interfaces</code> Configuration</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">auto lo
</span></span><span class="line"><span class="cl">iface lo inet loopback
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Backup Management Physical NIC</span>
</span></span><span class="line"><span class="cl">iface enp4s0 inet manual
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># MGMT Trunk NIC</span>
</span></span><span class="line"><span class="cl">iface enp1s0 inet manual
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># PCI Passthrough to pfSense</span>
</span></span><span class="line"><span class="cl">iface enp2s0 inet manual
</span></span><span class="line"><span class="cl">iface enp3s0 inet manual
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Backup Management Bridge (Plan to decommission)</span>
</span></span><span class="line"><span class="cl">auto vmbr0
</span></span><span class="line"><span class="cl">iface vmbr0 inet static
</span></span><span class="line"><span class="cl">    address 172.16.7.15/24
</span></span><span class="line"><span class="cl">    bridge-ports enp4s0
</span></span><span class="line"><span class="cl">    bridge-stp off
</span></span><span class="line"><span class="cl">    bridge-fd <span class="m">0</span>
</span></span><span class="line"><span class="cl">    bridge-vlan-aware yes
</span></span><span class="line"><span class="cl">    bridge-vids 2-4094
</span></span><span class="line"><span class="cl">    dns-nameservers 1.1.1.1 8.8.8.8
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># MGMT Trunk Bridge</span>
</span></span><span class="line"><span class="cl">auto vmbr1
</span></span><span class="line"><span class="cl">iface vmbr1 inet manual
</span></span><span class="line"><span class="cl">    bridge-ports enp1s0
</span></span><span class="line"><span class="cl">    bridge-stp off
</span></span><span class="line"><span class="cl">    bridge-fd <span class="m">0</span>
</span></span><span class="line"><span class="cl">    bridge-vlan-aware yes
</span></span><span class="line"><span class="cl">    bridge-vids 2-4094
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># VLAN 99 Subinterface for Proxmox Host</span>
</span></span><span class="line"><span class="cl">auto vmbr1.99
</span></span><span class="line"><span class="cl">iface vmbr1.99 inet static
</span></span><span class="line"><span class="cl">    address 172.16.99.15/24
</span></span><span class="line"><span class="cl">    gateway 172.16.99.1
</span></span></code></pre></div><h4 id="vlan-usage-by-containers">VLAN Usage by Containers<a hidden class="anchor" aria-hidden="true" href="#vlan-usage-by-containers">#</a></h4>
<p>Each LXC container is assigned to the appropriate VLAN through Proxmox’s <code>vlan tag</code> setting, while still connected to the same <code>vmbr1</code> bridge. This enables seamless multi-VLAN networking without needing additional physical NICs.</p>
<ul>
<li>
<p><strong>Omada Controller</strong>:</p>
<ul>
<li>Bridge: <code>vmbr1</code></li>
<li>VLAN Tag: <code>99</code></li>
<li>IP: <code>172.16.99.35/24</code></li>
</ul>
</li>
<li>
<p><strong>Pi-hole DNS</strong>:</p>
<ul>
<li>Bridge: <code>vmbr1</code></li>
<li>VLAN Tag: <code>21</code></li>
<li>IP: <code>172.21.21.21/24</code></li>
</ul>
</li>
</ul>
<p>With this configuration, containers receive only the VLAN traffic they are explicitly assigned, and host-level access is limited to a single tagged VLAN interface — a model that mirrors enterprise best practices in virtual networking.</p>
<h3 id="host-level-vlan-interface">Host-Level VLAN Interface<a hidden class="anchor" aria-hidden="true" href="#host-level-vlan-interface">#</a></h3>
<p>To maintain separation between the Proxmox host and the container traffic, a dedicated subinterface <code>vmbr1.99</code> is configured for the management VLAN. This allows host-level SSH and web access only from the management network.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">auto vmbr1.99
</span></span><span class="line"><span class="cl">iface vmbr1.99 inet static
</span></span><span class="line"><span class="cl">    address 172.16.99.15/24
</span></span><span class="line"><span class="cl">    gateway 172.16.99.1
</span></span><span class="line"><span class="cl">    vlan-raw-device vmbr1
</span></span></code></pre></div><h3 id="lxc-automation--cron-jobs">LXC Automation &amp; Cron Jobs<a hidden class="anchor" aria-hidden="true" href="#lxc-automation--cron-jobs">#</a></h3>
<p>To maintain the health and performance of containerized services within TillyNet, I’ve implemented lightweight automation using <code>cron</code> inside each LXC. This approach keeps core services updated and resilient without the overhead of full-scale configuration management tools — while still remaining extensible.</p>
<h4 id="pi-hole-lxc-300">Pi-hole (LXC 300)<a hidden class="anchor" aria-hidden="true" href="#pi-hole-lxc-300">#</a></h4>
<p>Automated via root cron job:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Run Pi-hole gravity update daily at 2:00 AM</span>
</span></span><span class="line"><span class="cl"><span class="m">0</span> <span class="m">2</span> * * * /usr/local/bin/pihole updateGravity &gt; /var/log/pihole_cron.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span></code></pre></div><p>This ensures the ad-blocking and threat feed lists are kept up-to-date without manual intervention.</p>
<h4 id="omada-controller-lxc-200">Omada Controller (LXC 200)<a hidden class="anchor" aria-hidden="true" href="#omada-controller-lxc-200">#</a></h4>
<p>Automated via cron for regular backups:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Backup Omada site config every day at 3:00 AM</span>
</span></span><span class="line"><span class="cl"><span class="m">0</span> <span class="m">3</span> * * * /opt/tplink/omada/data/autobackup.sh &gt;&gt; /var/log/omada_backup.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span></code></pre></div><p>The backup script syncs the controller config and wireless SSID/site layout to a local or external backup target.</p>
<h4 id="system-wide-both-lxcs">System-Wide (Both LXCs)<a hidden class="anchor" aria-hidden="true" href="#system-wide-both-lxcs">#</a></h4>
<p>General update routine:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Security updates every Sunday at 4:00 AM</span>
</span></span><span class="line"><span class="cl"><span class="m">0</span> <span class="m">4</span> * * <span class="m">0</span> apt update <span class="o">&amp;&amp;</span> apt -y upgrade &gt;&gt; /var/log/apt_cron.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span></code></pre></div><p>This ensures both containers remain patched and secured, with logs rotated weekly via <code>logrotate</code>.</p>
<hr>
<h2 id="services--roles">Services &amp; Roles<a hidden class="anchor" aria-hidden="true" href="#services--roles">#</a></h2>
<table>
  <thead>
      <tr>
          <th>Service</th>
          <th>Location</th>
          <th>IP (Subnet)</th>
          <th>VLAN</th>
          <th>Notes</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Firewall/Gateway</td>
          <td>pfSense VM</td>
          <td>Trunked interface</td>
          <td>All</td>
          <td>Routes all VLANs</td>
      </tr>
      <tr>
          <td>DNS Filtering</td>
          <td>Pi-hole LXC</td>
          <td>172.21.21.21/24</td>
          <td>21</td>
          <td>Internal DNS for all VLANs</td>
      </tr>
      <tr>
          <td>WAP Control</td>
          <td>Omada Controller</td>
          <td>172.16.99.35/24</td>
          <td>99</td>
          <td>Manages EAP access points</td>
      </tr>
      <tr>
          <td>Management GUI</td>
          <td>Proxmox Host</td>
          <td>172.16.99.15/24</td>
          <td>99</td>
          <td>VLAN-tagged virtual interface</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="switching-layer">Switching Layer<a hidden class="anchor" aria-hidden="true" href="#switching-layer">#</a></h2>
<ul>
<li><strong>Cisco Catalyst 2960-C</strong> switch</li>
<li>Configured with trunk ports for uplinks and Proxmox host</li>
<li>Native VLAN 666 used to isolate untagged traffic</li>
<li>Access and trunk ports statically assigned to appropriate VLANs</li>
<li>STP (PVST) with system-id extension enabled</li>
</ul>
<hr>
<h2 id="wireless-infrastructure">Wireless Infrastructure<a hidden class="anchor" aria-hidden="true" href="#wireless-infrastructure">#</a></h2>
<ul>
<li><strong>Access Point</strong>: TP-Link Omada EAP series</li>
<li><strong>Guest Wi-Fi</strong> SSID isolated via VLAN 14</li>
<li>WPA2/WPA3 mixed security</li>
<li>VLAN tagging applied per SSID to ensure proper segmentation</li>
</ul>
<hr>
<h2 id="security-posture">Security Posture<a hidden class="anchor" aria-hidden="true" href="#security-posture">#</a></h2>
<ul>
<li><strong>DNS Centralization</strong>: All VLANs rely on a local Pi-hole for DNS queries</li>
<li><strong>Access Control</strong>: Only specific ports (e.g., DNS, admin access) allowed</li>
<li><strong>Microsegmentation</strong>: Each VLAN is isolated; no lateral movement allowed</li>
<li><strong>GUI Lockdown</strong>: Firewall admin access restricted to trusted VLAN</li>
<li><strong>Guest Isolation</strong>: Guest devices have zero access to internal infrastructure</li>
</ul>
<hr>
<h2 id="learning-outcomes--skills-demonstrated">Learning Outcomes &amp; Skills Demonstrated<a hidden class="anchor" aria-hidden="true" href="#learning-outcomes--skills-demonstrated">#</a></h2>
<ul>
<li>Advanced <strong>VLAN trunking</strong> and switch configuration</li>
<li>Implementation of <strong>router-on-a-stick</strong> using pfSense</li>
<li>Design of <strong>containerized services</strong> using LXC on Proxmox</li>
<li>Mastery of <strong>firewall rule creation</strong> and <strong>policy-based routing</strong></li>
<li>Application of <strong>zero trust principles</strong> in a home network</li>
<li>Real-world exposure to <strong>enterprise wireless configuration</strong></li>
<li>Linux and open-source toolchain integration</li>
</ul>
<hr>
<h2 id="final-notes">Final Notes<a hidden class="anchor" aria-hidden="true" href="#final-notes">#</a></h2>
<p>This deployment represents the current live version of TillyNet and serves both as a personal learning platform and a functional demonstration of scalable, secure network design. Each layer is intentionally crafted to mirror best practices seen in production environments across SMB and enterprise infrastructure.</p>
<blockquote>
<p>Future plans include using Ansible for automated provisioning of LXC containers and firewall rule templating.
This is version 2.0 of TillyNet. Future versions will expand automation, introduce container orchestration, and deploy a backup DNS service.</p></blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://blog.tillynet.com/tags/homelab/">Homelab</a></li>
      <li><a href="https://blog.tillynet.com/tags/proxmox/">Proxmox</a></li>
      <li><a href="https://blog.tillynet.com/tags/pfsense/">Pfsense</a></li>
      <li><a href="https://blog.tillynet.com/tags/lxc/">Lxc</a></li>
      <li><a href="https://blog.tillynet.com/tags/vlan/">Vlan</a></li>
      <li><a href="https://blog.tillynet.com/tags/firewall/">Firewall</a></li>
      <li><a href="https://blog.tillynet.com/tags/pihole/">Pihole</a></li>
      <li><a href="https://blog.tillynet.com/tags/omada/">Omada</a></li>
      <li><a href="https://blog.tillynet.com/tags/network-segmentation/">Network-Segmentation</a></li>
      <li><a href="https://blog.tillynet.com/tags/self-hosted/">Self-Hosted</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://blog.tillynet.com/my-home-lab-journey/experimenting-with-network-topologies/">
    <span class="title">Next »</span>
    <br>
    <span>Experimenting With Network Topologies</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://blog.tillynet.com/">Tilly Net</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
